<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDA & Муравьиный алгоритм</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <script src="d3.v7.min.js"></script>
    <script src="bootstrap.min.js"></script>
    <script src="plot.min.js"></script>
    <script src="papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>EDA анализ и построение бинарного дерева решений</h1>

        <div class="accordion" id="analysisAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingData">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseData" aria-expanded="false" aria-controls="collapseData">
                        Загрузка данных
                    </button>
                </h2>
                <div id="collapseData" class="accordion-collapse collapse" aria-labelledby="headingData" data-bs-parent="#analysisAccordion">
                    <div class="accordion-body">
                        <input type="file" id="fileInput" accept=".csv">
                        <script>
                            document.getElementById('fileInput').addEventListener('change', function(e) {
                                let file = e.target.files[0];
                                let reader = new FileReader();
                                var data, parse_result, headers;
                                // id,Area,MajorAxisLength,MinorAxisLength,Eccentricity,ConvexArea,EquivDiameter,Extent,Perimeter,Roundness,AspectRation,Class
                                reader.onload = function(e) {
                                    data = e.target.result;
                                    // console.log(data);
                                    
                                    parse_result = Papa.parse(data, {header: true});
                                    data = parse_result.data;
                                    headers = parse_result.meta.fields;

                                    for (let i = 0; i < headers.length; i++) {
                                        if (headers[i] == "id") {
                                            continue;
                                        }
                                        if (headers[i] == "Class") {
                                            continue;
                                        }
                                        // calc interval for hist using Math 
                                        let num_data = data.map(d => Number(d[headers[i]])).filter(d => !isNaN(d));
                                        let interval = (Math.max(...num_data) - Math.min(...num_data)) / Math.ceil(Math.sqrt(num_data.length));
                                        // console.log(headers[i]);
                                        // console.log(...data.map(d => Number(d[headers[i]])));
                                        console.log(interval);
                                        // console.log(bin_count);

                                        var plt_svg = Plot.plot({
                                            width: 800,
                                            height: 400,
                                            x: {label: headers[i]},
                                            y: {label: "count"},
                                            aspectRatio: 1,
                                            marks: [
                                            Plot.rectY(data,  Plot.binX({y: "count"}, {x: headers[i], fill: "steelblue", interval:interval})),
                                            Plot.lineY( data.filter(d => d.Class == 1),
                                                        Plot.binX({y: "count"}, {x: headers[i], stroke: "red", strokeDasharray: "5,5", strokeWidth: 3, interval:interval})
                                                    ),
                                            Plot.lineY( data.filter(d => d.Class == 0),
                                                        Plot.binX({y: "count"}, {x: headers[i], stroke: "green", strokeDasharray: "5,5", strokeWidth: 3, interval:interval})
                                                    )
                                            ]
                                        });
                                        
                                        document.querySelector("#collapseEDA").appendChild(plt_svg);
                                        console.log(plt_svg);
                                    }
                                    
                                
                                    
                                }
                                reader.readAsText(file);


                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingEDA">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEDA" aria-expanded="false" aria-controls="collapseEDA">
                        EDA анализ
                    </button>
                </h2>
                <div id="collapseEDA" class="accordion-collapse collapse" aria-labelledby="headingEDA" data-bs-parent="#analysisAccordion">
                    <div class="accordion-body">
                        <!-- Секция для EDA анализа -->
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingAnt">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAnt" aria-expanded="false" aria-controls="collapseAnt">
                        Муравьиный алгоритм
                    </button>
                </h2>
                <div id="collapseAnt" class="accordion-collapse collapse" aria-labelledby="headingAnt" data-bs-parent="#analysisAccordion">
                    <div class="accordion-body">
                        <!-- Секция для визуализации муравьиного алгоритма -->
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingTree">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTree" aria-expanded="false" aria-controls="collapseTree">
                        Результирующее дерево решений
                    </button>
                </h2>
                <div id="collapseTree" class="accordion-collapse collapse" aria-labelledby="headingTree" data-bs-parent="#analysisAccordion">
                    <div class="accordion-body">
                        <!-- Секция для отображения дерева решений -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>